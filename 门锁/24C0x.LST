C51 COMPILER V9.60.0.0   24C0X                                                             03/24/2023 19:33:34 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE 24C0X
OBJECT MODULE PLACED IN 24C0x.OBJ
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE 24C0x.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #include"24C0x.h"
   4          //#include"mytype.h"
   5          #define uchar unsigned char
   6          #define uint unsigned int
   7          /********************************************************************
   8          * 文件名  ： EEPROM_24C02.c
   9          * 描述    :  该文件实现对24C02的操作。
  10                   确认试验是否成功：电源上电后，数码管的值在递增，观察值。关闭电源，待几秒后上电，
  11                   数码管显示的值会从断电钱的那个值开始显示。
  12          * 创建人  ： 陶奕恺，2013年4月3日
  13          ***********************************************************************/
  14          /********************************************************************
  15          * 名称 : flash()
  16          * 功能 : 延时,时间为2个NOP，大概为2US
  17          * 输入 : 无
  18          * 输出 : 无
  19          ***********************************************************************/
  20          void flash(void) 
  21          {
  22   1        _nop_();
  23   1        _nop_();
  24   1        _nop_();
  25   1        _nop_();
  26   1      }
  27          
  28          /********************************************************************
  29          * 名称 : x24c02_init()
  30          * 功能 : 24c02初始化子程序
  31          * 输入 : 无
  32          * 输出 : 无
  33          ***********************************************************************/
  34          void x24c02_init(void) 
  35          {  
  36   1        scl = 1;
  37   1        flash();
  38   1        sda = 1;
  39   1        flash();
  40   1      }
  41          
  42          /********************************************************************
  43          * 名称 : start(void)
  44          * 功能 : 启动I2C总线
  45          * 输入 : 无
  46          * 输出 : 无
  47          ***********************************************************************/
  48          void start(void)
  49          {
  50   1        scl = 1; 
  51   1        flash();
  52   1        sda = 1;
  53   1        flash(); 
  54   1        sda = 0; 
  55   1        flash(); 
C51 COMPILER V9.60.0.0   24C0X                                                             03/24/2023 19:33:34 PAGE 2   

  56   1        scl = 0; 
  57   1        flash();
  58   1      }
  59          
  60          /********************************************************************
  61          * 名称 : stop()
  62          * 功能 : 停止I2C总线
  63          * 输入 : 无
  64          * 输出 : 无
  65          ***********************************************************************/
  66          void stop() 
  67          {
  68   1        scl = 0;
  69   1        flash();
  70   1        sda = 0; 
  71   1        flash();
  72   1        scl = 1;
  73   1        flash();
  74   1        sda = 1;
  75   1        flash();
  76   1      }
  77          
  78          /********************************************************************
  79          * 名称 : writex()
  80          * 功能 : 写一个字节
  81          * 输入 : j（需要写入的值）
  82          * 输出 : 无
  83          ***********************************************************************/
  84          void writex(uchar j)
  85          {  
  86   1        uchar i,temp;
  87   1        temp = j;
  88   1        for(i=0; i<8; i++)
  89   1        {
  90   2          scl = 0; 
  91   2          flash(); 
  92   2          sda = (bit)(temp & 0x80); 
  93   2          flash();
  94   2          scl = 1; 
  95   2          flash();
  96   2          temp = temp << 1; 
  97   2        }
  98   1        scl = 0;
  99   1        flash(); 
 100   1      }
 101          
 102          /********************************************************************
 103          * 名称 : readx()
 104          * 功能 : 读一个字节
 105          * 输入 : 无
 106          * 输出 : 读出的值
 107          ***********************************************************************/
 108          uchar readx(void)
 109          {
 110   1        uchar i, j, k = 0;
 111   1        for(i=0; i<8; i++)
 112   1        {
 113   2          scl = 0;
 114   2          flash();    
 115   2          if(sda == 1)
 116   2          {
 117   3            j = 1;
C51 COMPILER V9.60.0.0   24C0X                                                             03/24/2023 19:33:34 PAGE 3   

 118   3          }
 119   2          else j = 0;
 120   2          k = (k << 1) | j; 
 121   2          scl = 1;
 122   2          flash();
 123   2        } 
 124   1        return(k);
 125   1      }
 126          
 127          /********************************************************************
 128          * 名称 : ack()
 129          * 功能 : I2C总线时钟
 130          * 输入 : 无
 131          * 输出 : 无
 132          ***********************************************************************/
 133          void ack(void)
 134          {
 135   1        uchar i = 0;
 136   1        scl = 1;
 137   1        flash();
 138   1        while((sda == 1) && (i < 255)) 
 139   1        {
 140   2          i++;
 141   2        }
 142   1        scl = 0;
 143   1        flash();
 144   1      }
 145          
 146          /********************************************************************
 147          * 名称 : x24c02_read()
 148          * 功能 : 从24c02中读出值
 149          * 输入 : address(要在这个地址读取值）
 150          * 输出 : 从24c02中读出的值
 151          ***********************************************************************/
 152          uchar x24c02_read(uchar address)
 153          {
 154   1        uchar i;
 155   1        start();
 156   1        writex(0xa0);
 157   1        ack();
 158   1        writex(address);
 159   1        ack();
 160   1        start();
 161   1        writex(0xa1);
 162   1        ack();
 163   1        i = readx();
 164   1        stop();
 165   1        return(i);
 166   1      }
 167          
 168          /********************************************************************
 169          * 名称 : x24c02_write()
 170          * 功能 : 想24c02中写入数据
 171          * 输入 : address(地址） ， info（值）
 172          * 输出 : 无
 173          ***********************************************************************/
 174          void x24c02_write(uchar address, uchar info)
 175          {
 176   1        start();
 177   1        writex(0xa0);
 178   1        ack();
 179   1        writex(address);
C51 COMPILER V9.60.0.0   24C0X                                                             03/24/2023 19:33:34 PAGE 4   

 180   1        ack();
 181   1        writex(info);
 182   1        ack();
 183   1        stop();
 184   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    226    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
